# To Do

## Current

- [ ] make symbols check work for shared library
- [ ] move building instructions into docs, document new options
- [ ] add optional wordlist support
- [ ] add optional markov support
- [ ] remove special character handling in favour of (:english:) and [:english:] type syntax.
- [ ] version releases with signed tags, generate versions from that
- [ ] generate changelog page
- [ ] extensive benchmarks
- [ ] simplify data structures
- [ ] character class subtraction <https://www.regular-expressions.info/charclasssubtract.html>
- [ ] character class intersection <https://www.regular-expressions.info/charclassintersect.html>
- [ ] add character classes like `[::emoji::]` or `[::english::]`, parsed from `unicode-data` <https://www.regular-expressions.info/posixbrackets.html>, or `(:english:)` for wordlists?
- [ ] add regex subroutines <https://www.regular-expressions.info/subroutine.html>, maybe recursion?
- [ ] add randomness distribution options (normal distribution as `a{normal(4, 2)}`, give probabilities for each option `a{0:0.2;1:0.3;2:0.5}`).
- [ ] add parse tree conversion to regex for testing?
- [ ] add backreference support (with `\k` or to group)
- [ ] optional features: gzip wordlist, json, debug
- [ ] add building support for meson/makefile/other build systems
- [ ] lazy-load word lists
- [ ] remove any use of globals
- [ ] parsing error backtrace (using parsing stack)
- [ ] AST to JSON output (for debugging purposes)
- [ ] internationalisation (maybe)
- [ ] speed up generation (caching and batched encode)
- [ ] benchmark (simple)
- [ ] different syntax for special groups (maybe)
- [ ] disallow escaped when not necessary
- [ ] website passgen.it with markdown template
- [ ] windows builds, debian packages
- [ ] wordlist support (gzipped)
- [ ] markov chain loading support
- [ ] improve const-correctness (mark everything as const that is const).
- [ ] implement markov chain selection for parser and generator! major blocker
    for feature-parity with legacy parser.
- [ ] write more documentation (in docs/, manual, paper, update man page).
    - [ ] 20% documentation coverage
    - [ ] 30% documentation coverage
    - [ ] 40% documentation coverage
    - [ ] 50% documentation coverage
    - [ ] 60% documentation coverage
    - [ ] 70% documentation coverage
    - [ ] 80% documentation coverage
    - [ ] 90% documentation coverage
    - [ ] 90% documentation coverage
- [ ] document base API
- [ ] implement static memory methods
- [ ] make pronounceable take simple pointer to markov structure
- [ ] make word list generation work
- [ ] write script to check sizes of the various components by parsing `nm` output
- [ ] write tool to determine size of various data structures (using size, nm, objdump)
- [ ] add static assertions to check size of structs
- [ ] rearrange struct members to potentially save space?
- [ ] clean up data structures
- [ ] think about the syntax of special characters
- [ ] json generation for all data structures (autogenerated with pycparser?)
- [ ] remove legacy code
    - [ ] `pattern.c`
    - [ ] `pattern_random.c`
    - [ ] `pattern_presets.c`
- [ ] review code coverage and perhaps add more tests
    - [ ] 90% test coverage
    - [ ] 95% test coverage
    - [ ] 98% test coverage
    - [ ] 99% test coverage
- [ ] improve makeshift test framework (forking? shuffling? verbose/non-verbose mode?)
- [ ] add or think about memory handling
- [ ] reimplement memory handling, benchmark to make sure it doesn't affect performance too much
- [ ] adapt generation for new data structures
- [ ] write benchmark for new parser
- [ ] try changing parser state stack to linked list?
- [ ] implement stack depth limiting for new parser (as separate method)
- [ ] implement code profiling
- [x] implement static analysis (linter, clang-tidy?) (nope)
- [x] fix debug build on alpine
- [x] change all APIs that aren't prefixed with `passgen_` to have that prefix
    - [ ] `pattern_*` (deprecated)
    - [ ] `reader_*` (deprecated)
    - [ ] `unicode_*` (deprecated)
    - [x] `parser_*`
    - [x] `random_*`
    - [x] `parse_*`
    - [x] `utf8_*`
- [x] improve token parser API with new codepoint semantics
- [x] add osx build to build system using osxbuild docker image
- [x] work on memory subsystem, moving things into data/
- [x] fix header installation paths
- [x] move enum mappings declarations into own header
- [x] make sure german umlauts work with pronounceable generation
- [x] investigate building and running on alpine without libexecinfo
- [x] fix git info issue in CI
- [x] rename pronounceable to markov
    - [x] `markov_language_autogen.c`
    - [x] api
- [x] fix inclusion of `PASSGEN_TOKEN_ESCAPED_BIT` flag in parser.
- [x] move data structures from pronounceable and memory into data/
- [x] make `passgen_pattern_char` store multiple characters - it can be bigger to be as large as the other item types (group, set, special) so we don't waste space
- [x] make all markov chains get autogenerated
- [x] make pronounceable generation work
- [x] fix `generate_markov.rb` script for CI
- [x] rename `passgen_random_uint64` to `_u64`, and `_i64`, for more concise function names
- [x] make pronounceable work for passgen2
- [x] investigate crashes with passgen "\p[german]{2,20}"
- [x] build utility to check size of data structures
- [x] rewrite the parser, it should be a state machine
    - [x] implement group parsing
    - [x] implement set parsing
    - [x] implement set range parsing
    - [x] implement repeat parsing
    - [x] implement escape handling
    - [x] implement special character parsing
- [x] implement question mark operator (a? -> 'a' or '')
- [x] squash compiler warnings
    - [x] get rid of easy ones
    - [x] get rid of all
- [x] incorporate token parser change into parser
- [x] remove normal_escaped handling
- [x] use CPack in CI to generate packages and publish
- [x] fix include-what-you-use recommendations
- [x] add check target to see if library exports any symbols that are not
    prefixed with *passgen* and perhaps one to check if it exports any defines
    that aren't prefixed with *PASSGEN*.
- [x] implement include-what-you-use
- [x] change token parser to merge codepoint and escaped members
- [x] remove useless enums from token parser
- [x] remove or disable non-deterministic tests (made tests deterministic)
- [x] add pseudorandom number generation to randomness
- [x] add ~~cldoc~~ doxygen documentation output to build system (why not cldoc? unmaintained, unfortunately).
- [x] publish doxygen documentation in CI
- [x] add code coverage generation to CI system
- [x] write or enable benchmarks for random API to check performance
- [x] change random object to have just a buffer and a pointer to a function
    used to fill the buffer again (to allow the use of different backends).
- [x] enable memory sanitizer for tests
- [x] move all `include/passgen/pattern/*.h` data structures into `include/passgen/data/`.
- [x] rewrite the token parser. it should be a state machine
- [x] test list autogeneration (done in `scripts/tests_generate.rb`)
- [x] enum mapping autogeneration (done in `scripts/generate_enum_mapping.rb`)
- [x] rename array to queue or stack
    - [x] move all uses of array over to stack
- [x] implement type specialisations for array data type
- [x] implement code coverage generation
- [x] implement automatic code formatting
- [x] implement sanitizer support
- [x] make generation code work with new parser and data structures

## Ideas

- Unity build (better optimisation)
- Link-time optimisation
- CPack generate tarball, debian package, etc.

- rewrite the passgen parser to use batched operations, meaning that all
  all unicode should be parsed in one go, then all (or 128) tokens should
  be parsed at a time. but still allow it to be used in a streaming manner.
  this should be more optimal for speed and also just lead to cleaner code.
- make the data structures pretty. they should be maintainable, and optionally
  allow for JSON output for debugging
- write benchmarks to make sure that the parser is quick. that's the whole
  reason this is written in C, anyways.
- write a fuzzing backend, using AFL or the like, to ensure there are no bugs
  that can crash the parser.
- optimise the testing system, perhaps use another testing framework that is
  more actively maintained, test more edge cases and use macros to write clean
  tests.
- implement wordlist functionality (find a space-efficient way to store large
  word lists?)
